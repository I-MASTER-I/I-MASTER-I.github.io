---
layout:     BLACKCODE
title:      "[Azure] SUSE Linux Enterprise Server에서 Pacemaker 설정"
subtitle:   "Azure SAP Pacemaker 설정"
description: "[Microsoft Docs 참고](https://learn.microsoft.com/ko-kr/azure/sap/workloads/high-availability-guide-suse-pacemaker#a-assign-the-custom-role-to-the-service-principal)"
date:       2023-02-28 1:10:01
author:     "MADness"
header-img: "assets/owner/hero/home-bg.jpg"
header-video: "assets/video/metrix.mp4"
thumbnail: /assets/owner/blog/thumbs/thumb01.png
tags: [Azure]
category: [Azure]

# img url : /assets/category/Azure/2023/02/27
---


# PaceMaker

---
## 목차
1. 인프라 구성

2. 서비스 주체 사용
    - VM 서비스 주체 등록
    - 펜스 에이전트에 대한 사용자 지정 역할 만들기

3. pacemaker 설치
    - 키 생성
        - 각 노드에 서로간의 키 등록
        - ssh
    
    - host 등록
        - 사설아이피 등록
        - ping 등록된 도메인네임으로 테스트

4. 웹 구동 확인
    - 아웃바운드 포트 등록
    - 7630포트 접속

5. ISO 파일 마운트

---
---

# [1]. 인프라 구성

1. 전체 아키텍처 구성
![SAP 아키텍처 설계](/assets/category/Azure/2023/03/03/Ver2.png)
    1. Resource Group 생성 : PoCShowRoom
    2. Virtual Network 생성

    네트워크 명 | 네트워크 주소
    ---------- | ------------
    MGMT            | 10.0.0.0/16
    SAP-vn          | 10.1.0.0/16
    AP_1            | 10.1.1.0/24
    AP_2            | 10.1.2.0/24
    DB_1            | 10.1.3.0/24
    DB_2            | 10.1.4.0/24

3. 리소스 생성
    1. AP Server Resource 구성
    ![img](/assets/category/Azure/2023/02/27/AP1-01.PNG)
    ```
        EX) AP #1 가상머신 구성
    ```
    * [TEST 계정]
        - id : demouser
        - pw : demo!pass123

    가상머신이름 | 설정  | 선택
    ----------- | ---- | ----
    ALL | OS | 배포판 : SUSE Enterprise Linux for SAP 15 SP1 +24x7 Support - 2Gen
    ALL | OS image | ![img](/assets/category/Azure/2023/02/27/AP1-02.PNG)
    AP-1, DB-1 | 가용성 영역 | **Zone 1**
    AP-2, DB-2 | 가용성 영역 | **Zone 3**
    AP-1 | 네트워크 주소 | AP_1 10.1.1.0/24
    AP-2 | 네트워크 주소 | AP_2 10.1.2.0/24
    DB-1 | 네트워크 주소 | DB_1 10.1.3.0/24
    DB-2 | 네트워크 주소 | DB_2 10.1.4.0/24

# [2]. Azure 펜스 에이전트 사용
1. 관리 ID 사용
2. 서비스 주체 사용 [해당 방식으로 진행]
    1. 구독 > 액세스 제어(IAM) 클릭
    ![서비스 주체 사용 방식](/assets/category/Azure/2023/03/03/01.png)
    2. 추가를 클릭하여 **사용자 지정 역할 추가** 클릭
    ![서비스 주체 사용 방식](/assets/category/Azure/2023/03/03/02.png)
    3. 기본탭에서 **사용자 지정 역할 이름** 입력, 기준 권한에서 JSON에서 시작 선택
    ![서비스 주체 사용 방식](/assets/category/Azure/2023/03/03/03.png)
    4. JSON탭에서 편집버튼을 클릭해서 편집모드로 설정
    ![서비스 주체 사용 방식](/assets/category/Azure/2023/03/03/04.png)
    5. 구독 아이디만 변경하여 아래 JSON 내용 복사 붙여넣기 후 저장 후 다음
    ```
    {
        "properties": {
            "roleName": "자동생성됨",
            "Name": "Linux fence agent Role",
            "description": "Allows to power-off and start virtual machines",
            "description": "",
            "assignableScopes": [
                "/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
            ],
            "permissions": [
                {
                    "actions": ["Microsoft.Compute/*/read",
                            "Microsoft.Compute/virtualMachines/powerOff/action",
                            "Microsoft.Compute/virtualMachines/start/action"],
                    "notActions": [],
                    "dataActions": [],
                    "notDataActions": []
                }
            ]
        }
    }
    ```
    ![서비스 주체 사용 방식](/assets/category/Azure/2023/03/03/05.png)


```
    1. Azure Portal에서 Azure Active Directory > 속성을 선택한 다음 디렉터리 ID를 기록해 둡니다. 이 ID는 테넌트 ID입니다.
    2. 앱 등록을 선택합니다.
    3. 새 등록을 선택합니다.
    4. 등록 이름을 입력한 다음 이 조직 디렉터리에만 있는 계정을 선택합니다.
    5. 애플리케이션 형식에서 웹을 선택하고 로그온 URL(예: http://localhost)을 입력한 다음 추가를 선택합니다.   
    로그온 URL이 사용되지 않으며, 이 URL은 임의의 올바른 URL이 될 수 있습니다.
    7. 인증서 및 비밀을 선택한 다음 새 클라이언트 암호을 선택합니다.
    8. 새 키에 대한 설명을 입력하고 만료되지 않음을 선택한 다음 추가를 선택합니다.
    9. 서비스 주체의 암호로 사용할 값을 기록해 둡니다.
    10. 개요를 선택한 다음 서비스 주체의 사용자 이름으로 사용할 애플리케이션 ID를 기록해 둡니다.
```