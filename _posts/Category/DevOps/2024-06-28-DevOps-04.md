---
layout:     BLACKCODE
title: "Jenkins 서버에서 WEB서버로 ssh 배포 설정"
subtitle:   ""
description: ""
date: 2024-06-28 01:00:00 +0900
author:     "김민서"
header-img: "assets/owner/hero/home-bg.jpg"
header-video: "assets/video/metrix.mp4"
thumbnail: /assets/owner/blog/thumbs/thumb01.png
tags: [SVN]
category: [DEVOPS]
# comments: false
# share: false
---

# 환경구성
1. SVN Server 1대
2. Jenkins Server 1대
3. WAS Server 1대

# 1. Jenkins 설정

## 1. Publish Over SSH Plugin 설치
### 1). Dashboard > Jenkins 관리로 이동 후 Plugins를 클릭한다.

![img](/assets/category/DevOps/04/1-1.png)

### 2). Available plugins를 선택하고 `Publish over ssh`를 검색하여 설치한다.

![img](/assets/category/DevOps/04/1-2.png)

### 3). 설치가 끝나고 실행중인 작업이 없으면 Jenkins를 재시작한다.

![img](/assets/category/DevOps/04/1-2.png)

## 2. SSH접속 설정
### 1). Dashboard 에서 작업할 job을 선택합니다.
![img](/assets/category/DevOps/04/2-1.png)

### 2). 구성을 선택합니다.
![img](/assets/category/DevOps/04/2-2.png)

### 3). 빌드 환경에서 Send files or execute commands over SSH after the build runs를 체크합니다.
![img](/assets/category/DevOps/04/2-3.png)

### 4). Send files or execute commands over SSH after the build runs 설정
1. SSH Server설정.

    배포할 서버 선택
    
    ![img](/assets/category/DevOps/04/2-4.png)
    
    * 아래 이미지와 같이 SSH Server를 등록하지 않은 경우
        ![img](/assets/category/DevOps/04/ssh_server_00.png)

    1. Dashboard > Jenkins 관리 > System(시스템 설정)메뉴로 진입
        ![img](/assets/category/DevOps/04/ssh_server_01.png)
    2. SSH Servers에서 추가를 눌러 SSH Server를 추가
        ![img](/assets/category/DevOps/04/ssh_server_02.png)
    3. 다음과 같이 배포대상 VM정보를 입력하여 추가
        - Name : 서버를 구분하기 위한 명칭
        - Hostname : 서버 주소
        - Username : 배포자명
        - Remote Directory : 배포 원격 디렉토리
        ![img](/assets/category/DevOps/04/ssh_server_03.png)
    4. 고급을 눌러 설정한 VM환경에 맞게 세팅해준다.

        나같은 경우 Azure VM에 ID/Password방식으로 구성했기 때문에 `Passphrase /     Password`에서 해당 VM의 비밀번호만 넣어주면 된다. 토큰 인증방식으로 구성한  경우 별도의 인증키를 넣어주어야 한다.
        ![img](/assets/category/DevOps/04/ssh_server_04.png)

    5. 위 사항을 정확히 입력 후 Test Configuration을 클릭하면 왼쪽에 `Success`라고   뜬다. 확인 후 저장을 누른다.
        ![img](/assets/category/DevOps/04/ssh_server_05.png)

2. Transfers 설정.
    - Source files : gradle build 시 jar파일이 생성되는 디렉토리인  'build/libs'
    - Remove prefix : 위에 설정한 소스파일 위치에서 제거할 폴더를 설정하는 부분
    - Remote Directory : 
    
        ssh server등록시 /home/master/was/SpringBoot/였다면 그 이하 디렉토리에서 어디에 둘것인가 정하는 경로
    
    - Exec command : 위의 과정을 거치고 커맨드 명령어를 날리는 부분
    ![img](/assets/category/DevOps/04/Transfers_01.png)

### 5). Build steps
1. Build Steps > Add build step을 눌러 `invoke Gradle script`를 선택
    ![img](/assets/category/DevOps/04/2-5.png)

2. Gradle Version 선택
    * Gradle Version 이 없는 경우
        ![img](/assets/category/DevOps/04/Gradle_01.png)
    1. Dashboard > Jenkins 관리 > Tools(Global Tool Configuration) 메뉴로 진입 
        ![img](/assets/category/DevOps/04/Gradle_02.png)
    2. Gradle installations에서 Add Gradle 클릭하여 name작성 및 Install from Fradle.org 버전을 선택한다. 
        ![img](/assets/category/DevOps/04/Gradle_03.png)
    3. invoke Gradle script에서 Gradle Version을 선택
        ![img](/assets/category/DevOps/04/Gradle_04.png)

3. Tasks에 clean build라고 입력
    ![img](/assets/category/DevOps/04/2-6.png)

4. 저장을 눌러 완료