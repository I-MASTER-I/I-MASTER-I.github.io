---
layout:     BLACKCODE
title:      "컨피그맵과 비밀값으로 애플리케이션 설정하기"
subtitle:   ""
description: ""
date:       2018-01-01 01:30:00
author:     "MADness"
header-img: "assets/owner/hero/home-bg.jpg"
header-video: "assets/video/metrix.mp4"
thumbnail: /assets/owner/blog/thumbs/thumb01.png
tags: [Azure]
category: [Kubernetes]
# comments: false
# share: false
---

# 4.1 쿠버네티스에서 애플리케이션에 설정이 전달되는 과정
- ConfigMap과 Secret
    - 적은양의 데이터 저장이 목적
## `환경변수`
- 설정값을 저장하는 가장 기본적인 변수

### [sleep.yaml] 기본 pod 배포
```yml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: sleep
spec:
  selector:
    matchLabels:
      app: sleep
  template:
    metadata:
      labels:
        app: sleep
    spec:
      containers:
        - name: sleep
          image: kiamol/ch03-sleep

```

- 명령어 실습
```cmd
master@master:~/study-kubernetes$ kubectl apply -f sleep.yaml
deployment.apps/sleep created
master@master:~/study-kubernetes$ kubectl get pods
NAME                     READY   STATUS    RESTARTS   AGE
sleep-85fdd4cf75-rc7zh   1/1     Running   0          20s
master@master:~/study-kubernetes$ kubectl wait --for=condition=Ready pod -l app=sleep
pod/sleep-85fdd4cf75-rc7zh condition met

# printenv : 환경변수 확인 명령어
master@master:~$ kubectl exec deploy/sleep -- printenv HOSTNAME KIAMOL_CHAPTER
sleep-85fdd4cf75-rc7zh
command terminated with exit code 1
```

### [sleep-with-env.yaml] Deployment에서 파드 정의를 수정(환경변수 추가)
- KIAMOL_CHAPTER 환경변수의 정의 새로 추가
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: sleep
spec:
  selector:
    matchLabels:
      app: sleep
  template:
    metadata:
      labels:
        app: sleep
    spec:
      containers:
        - name: sleep
          image: kiamol/ch03-sleep
          env:                      # 환경 변수 정의
          - name: KIAMOL_CHAPTER    # 환경 변수 이름
            value: "04"             # 환경 변수 값
```

- 명령어 실습
```cmd
master@master:~/study-kubernetes$ kubectl apply -f sleep-with-env.yaml
deployment.apps/sleep configured
master@master:~/study-kubernetes$ kubectl exec deploy/sleep -- printenv HOSTNAME KIAMOL_CHAPTER
sleep-58bcd9564-j6xch
04
```

### 정리
- 간단한 설정같은 경우 `POD정의`에 포함시켜도 나쁘지 않음
- 복잡한 설정같은 경우 `ConfigMap`을 사용하는것이 적절

## `ConfigMap`
- POD에서 읽어들이는 데이터를 저장하는 리소스
- 데이터 저장하는 형태는 제약없음
- 하나 또는 그 이상의 파드에 연결될 수 있는 독립된 리소스

### [sleep-with-configMap-env.yaml] POD정의에서 ConfigMap 읽어들이기
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: sleep
spec:
  selector:
    matchLabels:
      app: sleep
  template:
    metadata:
      labels:
        app: sleep
    spec:
      containers:
        - name: sleep
          image: kiamol/ch03-sleep
          env:
          - name: KIAMOL_CHAPTER
            value: "04"
          - name: KIAMOL_SECTION
            valueFrom:
              configMapKeyRef:              
                name: sleep-config-literal
                key: kiamol.section
```

- 명령어 실습
```cmd
# ConfigMap 생성
master@master:~/study-kubernetes$ kubectl create configmap sleep-config-literal --from-literal=kiamol.section='4.1'
configmap/sleep-config-literal created

#
```