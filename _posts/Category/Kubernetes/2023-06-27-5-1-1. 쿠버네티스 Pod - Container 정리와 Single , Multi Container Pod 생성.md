---
layout:     BLACKCODE
title:      "5-1-1. 쿠버네티스 Pod - Container 정리와 Single / Multi Container Pod 생성"
subtitle:   "5-1-1. 쿠버네티스 Pod - Container 정리와 Single / Multi Container Pod 생성"
description: "https://www.youtube.com/watch?v=0rYt3PcggzA&list=PLApuRlvrZKohaBHvXAOhUD-RxD0uQ3z0c&index=10"
date:       2023-01-31 1:10:00
author:     "MADness"
header-img: "assets/owner/hero/home-bg.jpg"
header-video: "assets/video/metrix.mp4"
thumbnail: /assets/owner/blog/thumbs/thumb01.png
tags: [Azure]
category: [Kubernetes]
# comments: false
# share: false
---

# *** K8S 명령어 실습전 AKS 환경 준비 ***

## VSCODE에서 Azure Potal 접속
1. VSCode에서 명령어 실행
```
Connect-AzAccount
```

2. 계정 선택 및 로그인 진행
![img](https://github.com/IIBlackCode/IIBlackCode.github.io/blob/master/_posts/Category/Kubernetes/img/Connect-AzAccount.PNG?raw=true)

* 아래와 같이 연동작업 

```
PS D:\GIT> Connect-AzAccount
경고: Unable to acquire token for tenant '4aed9820-113d-4f48-9f53-4d91f37ad279' with error 'SharedTokenCacheCredential authentication unavailable. Token acquisition 
failed for user minseo_kim89@megazone.com. Ensure that you have authenticated with a developer tool that supports Azure single sign on.'

Account                   SubscriptionName TenantId                             Environment
-------                   ---------------- --------                             -----------
minseo_kim89@megazone.com kms-limited      xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx AzureCloud
```
3. [AzurePotal] Azure Potal에 접속
    
    1). 상단에 있는 Cloud Shell을 클릭하여 `스토리지 생성`
![img](https://github.com/IIBlackCode/IIBlackCode.github.io/blob/master/_posts/Category/Kubernetes/img/AzureCloudShell.png?raw=true)<br>
    2). 스토리지 만들기 클릭
![img](https://github.com/IIBlackCode/IIBlackCode.github.io/blob/master/_posts/Category/Kubernetes/img/createStorage.PNG?raw=true)<br>
    3). Cloud Shell 진입
![img](https://github.com/IIBlackCode/IIBlackCode.github.io/blob/master/_posts/Category/Kubernetes/img/AccessAzureCloudShell.png?raw=true)

4. VSCODE에서 Azure Cloud Shell 클릭
![img](https://github.com/IIBlackCode/IIBlackCode.github.io/blob/master/_posts/Category/Kubernetes/img/2023-01-25-Kubernetes-05_1.png?raw=true)

5. 상단에 구독 선택
![img](https://github.com/IIBlackCode/IIBlackCode.github.io/blob/master/_posts/Category/Kubernetes/img/2023-01-25-Kubernetes-05_2.png?raw=true)

6. VSCode에서 접속 성공한 모습
![img](https://github.com/IIBlackCode/IIBlackCode.github.io/blob/master/_posts/Category/Kubernetes/img/2023-01-25-Kubernetes-05_3.png?raw=true)

## VSCode 연동작업 완료

---
# 학습내용
- Pod 개념 및 사용하기
- livenessProbe를 사용한 self-healing Pod
- init container
- infra container(pause) 이해하기
- static pod 만들기
- Pod에 resource 할당하기
- 환경변수를 이용해 컨테이너에 데이터 전달하기
- pod 구성 패턴의 종류
---

# Container와 Pod의 개념
## 1. Pod 개념 및 사용하기
### Container 정리
```
cat > app.js
const http = require('http');
const os = require('os');
console.log("Test server starting...");
var handler = function(req, res) {
  res.writeHead(200);
  res.end("Container Hostname: " + os.hostname() + "\n");
};
var www = http.createServer(handler);
www.listen(8080);

cat > Dockerfile
FROM node:12
COPY app.js/app/js
ENTRYPOINT ["node", "app.js"]
<Ctrl><d>

- docker build -t smlinux/appjs .
- docker push smlinux/appjs
```

### Pod란?
- 컨테이너를 표현하는 k8s api의 최소 단위   
- api에서 pod동작은 불가능   
- pod에는 하나 또는 여러 개의 컨테이너가 포함될 수 있음   

### Pod 생성하기
1. kubectl run명령(CLI)으로 생성
    ```
    kubectl run webserver --image=nginx:1.14
    ```
2. pod yaml을 이용해 생성
    - nginx-pod.yaml파일 작성
        ```
        apiVersion: v1
        kind: Pod
        metadata:
        name: nginx-pod
        spec:
        containers:
        - name: nginx-container
            image: nginx:1.14
            ports:
            - containerPort: 80
            protocol: TCP
        ```
    - 명령어 
        ```
        # Pod 실행
        kubectl create -f pod-nginx.yaml

        # 현재 동작중인 pod 확인
        kubectl get pods
        kubectl get pods -o wide
        kubectl get pods -o yaml
        kubectl get pods -o json
        kubectl get pods webserver -o json | grep -i podip

        # Pod에 접속해서 결과보기
        curl <pod's IP address>
        ```

# 실습
## 1.14버전의 nginx이미지를 web1이름의 pod로 실행
```
kubectl run web1 --image=nginx:1.14 

# port번호 지정
kubectl run web1 --image=nginx:1.14 --port=80
```

## 실행중인 pod 확인
```
kubectl get pods
```

## yaml파일로 pod 생성
```
kubectl create -f <파일명>
```

## 현재 실행중인 pod 상태를 yaml포멧으로 보기
```
kubectl get pods <pod명> -o yaml
```

## 현재 실행중인 모든 pod 상태를 yaml포멧으로 보기
```
kubectl get pods -o yaml
```

## 현재 실행중인 모든 pod 상태를 json포멧으로 보기
```
kubectl get pods -o json
```

## json 형식으로 pod 아이피만 보기
```
kubectl get pods -o json | grep -i podip
```

# Milti Container Pod 생성

## multi containter pod의 yaml파일 작성
```
cat > pod-multi.yaml
apiVersion: v1
kind: Pod
metadata:
  name: multipod
spec:
  containers:
  - name: nginx-container
    image: nginx:1.14
    ports:
    - containerPort: 80
  - name: centos-container
    image: centos:7
    command:
    - sleep
    - "10000"
```

## 실행결과
```
master@MASTER:~$ kubectl create -f pod-multi.yaml
pod/multipod created
```
> READY가 2/2인 멀티 컨테이너 표시를 볼 수 있다.
```
master@MASTER:~$ kubectl get pods -o wide
NAME        READY   STATUS    RESTARTS   AGE    IP           NODE    NOMINATED NODE   READINESS GATES
multipod    2/2     Running   0          96s    10.244.1.6   node1   <none>           <none>
nginx-pod   1/1     Running   1          5d2h   10.244.1.5   node1   <none>           <none>
web1        1/1     Running   1          5d2h   10.244.2.5   node2   <none>           <none>
```
